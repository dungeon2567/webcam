(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{8041:function(e,t,n){"use strict";var r=n("af78"),a=n.n(r);a.a},"8b24":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"flex flex-center q-pa-md"},[n("div",{staticClass:"container"},[n("div",{staticClass:"video-container"},[n("video",{ref:"self",attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})]),e._l(e.participants,(function(e){return n("div",{key:e.id,staticClass:"video-container"},[n("video",{ref:"peer-"+e.id,refInFor:!0,attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})])}))],2)])},a=[],i=n("967e"),s=n.n(i),c=(n("7514"),n("20d6"),n("96cf"),n("fa84")),o=n.n(c),d={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},u={name:"PageIndex",data:function(){return{participants:[]}},mounted:function(){var e=this;this.ws=new WebSocket("wss://".concat(location.host,"/room"));var t=this;this.ws.addEventListener("open",function(){var n=o()(s.a.mark((function n(r){var a;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.ws.addEventListener("message",function(){var n=o()(s.a.mark((function n(r){var a,i,c,o,d,u,p,f,l,v;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=JSON.parse(r.data),n.t0=a.t,n.next="watcher.remove"===n.t0?4:"watcher.add"===n.t0?7:"candidate"===n.t0?18:"answer"===n.t0?21:"offer"===n.t0?25:36;break;case 4:return i=e.participants.findIndex((function(e){return e.id==a.id})),-1!=i&&(c=e.participants[i],c.peerConnection.close(),e.participants.splice(i,1)),n.abrupt("break",36);case 7:return console.log("watcher.add: "+a.id),o=e.getOrCreateParticipant(a.id),d=t.$refs.self.srcObject,d.getTracks().forEach((function(e){return o.peerConnection.addTrack(e,d)})),n.next=13,o.peerConnection.createOffer();case 13:return u=n.sent,n.next=16,o.peerConnection.setLocalDescription(u);case 16:return t.ws.send(JSON.stringify({t:"offer",id:a.id,message:u})),n.abrupt("break",36);case 18:return p=e.participants.find((function(e){return e.id==a.id})),p&&p.peerConnection.addIceCandidate(new RTCIceCandidate(a.message)).catch((function(e){console.error(e)})),n.abrupt("break",36);case 21:return console.log("answer"),f=e.participants.find((function(e){return e.id==a.id})),f&&f.peerConnection.setRemoteDescription(a.message),n.abrupt("break",36);case 25:return console.log("offer"),l=e.getOrCreateParticipant(a.id),n.next=29,l.peerConnection.setRemoteDescription(a.message);case 29:return n.next=31,l.peerConnection.createAnswer();case 31:return v=n.sent,n.next=34,l.peerConnection.setLocalDescription(v);case 34:return t.ws.send(JSON.stringify({t:"answer",id:a.id,message:v})),n.abrupt("break",36);case 36:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.next=3,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}):navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0});case 3:a=n.sent,e.$refs.self.srcObject=a,e.ws.send(JSON.stringify({t:"broadcast.start"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},methods:{getOrCreateParticipant:function(e){var t=this.participants.find((function(t){return t.id===e}));if(t)return t;t={id:e,peerConnection:new RTCPeerConnection(d)};var n=this;return t.peerConnection.onicecandidate=function(t){t.candidate&&n.ws.send(JSON.stringify({t:"candidate",id:e,message:t.candidate}))},t.peerConnection.ontrack=function(e){n.$nextTick((function(){var r=n.$refs["peer-".concat(t.id)][0];r&&(r.srcObject=e.streams[0])}))},this.participants.push(t),t}}},p=u,f=(n("8041"),n("2877")),l=n("eebe"),v=n.n(l),w=n("9989"),g=Object(f["a"])(p,r,a,!1,null,null,null);t["default"]=g.exports;v()(g,"components",{QPage:w["a"]})},af78:function(e,t,n){}}]);