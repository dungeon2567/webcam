(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{8041:function(e,n,t){"use strict";var r=t("af78"),a=t.n(r);a.a},"8b24":function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("q-page",{staticClass:"flex flex-center q-pa-md"},[t("div",{staticClass:"container"},[t("div",{staticClass:"video-container"},[t("video",{ref:"self",attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})]),e._l(e.participants,(function(e){return t("div",{key:e.id,staticClass:"video-container"},[t("video",{ref:"peer-"+e.id,refInFor:!0,attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})])}))],2)])},a=[],i=t("967e"),s=t.n(i),c=(t("7514"),t("20d6"),t("96cf"),t("fa84")),o=t.n(c),d={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},u={name:"PageIndex",data:function(){return{participants:[]}},mounted:function(){var e=this;this.ws=new WebSocket("wss://".concat(location.host,"/room"));var n=this;this.ws.addEventListener("open",function(){var t=o()(s.a.mark((function t(r){var a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.ws.addEventListener("message",function(){var t=o()(s.a.mark((function t(r){var a,i,c,o,d,u,p,f,l;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=JSON.parse(r.data),t.t0=a.t,t.next="watcher.remove"===t.t0?4:"watcher.add"===t.t0?7:"candidate"===t.t0?12:"answer"===t.t0?16:"offer"===t.t0?20:30;break;case 4:return i=e.participants.findIndex((function(e){return e.id==a.id})),-1!=i&&(c=e.participants[i],c.peerConnection.close(),e.participants.splice(i,1)),t.abrupt("break",30);case 7:return console.log("watcher.add: "+a.id),o=e.getOrCreateParticipant(a.id),d=n.$refs.self.srcObject,d.getTracks().forEach((function(e){return o.peerConnection.addTrack(e,d)})),t.abrupt("break",30);case 12:return console.log("candidate"),u=e.participants.find((function(e){return e.id==a.id})),u&&u.peerConnection.addIceCandidate(new RTCIceCandidate(a.message)).catch((function(e){console.error(e)})),t.abrupt("break",30);case 16:return console.log("answer"),p=e.participants.find((function(e){return e.id==a.id})),p&&p.peerConnection.setRemoteDescription(a.message),t.abrupt("break",30);case 20:return f=e.getOrCreateParticipant(a.id),console.log("offer"),f.peerConnection.setRemoteDescription(a.message),t.next=25,f.peerConnection.createAnswer();case 25:return l=t.sent,t.next=28,f.peerConnection.setLocalDescription(l);case 28:return n.ws.send(JSON.stringify({t:"answer",id:a.id,message:l})),t.abrupt("break",30);case 30:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=3,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}):navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0});case 3:a=t.sent,e.$refs.self.srcObject=a,e.ws.send(JSON.stringify({t:"broadcast.start"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},methods:{getOrCreateParticipant:function(e){var n=this.participants.find((function(n){return n.id===e}));if(n)return n;n={id:e,peerConnection:new RTCPeerConnection(d),initialized:!1};var t=this;return n.peerConnection.onicecandidate=function(n){n.candidate&&t.ws.send(JSON.stringify({t:"candidate",id:e,message:n.candidate}))},n.peerConnection.onnegotiationneeded=o()(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.peerConnection.createOffer();case 2:if(a=r.sent,"stable"==n.peerConnection.signalingState){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,n.peerConnection.setLocalDescription(a);case 7:t.ws.send(JSON.stringify({t:"offer",id:e,message:a}));case 8:case"end":return r.stop()}}),r)}))),n.peerConnection.ontrack=function(e){t.$nextTick((function(){var r=t.$refs["peer-".concat(n.id)][0];r&&(r.srcObject=e.streams[0])}))},this.participants.push(n),n}}},p=u,f=(t("8041"),t("2877")),l=t("eebe"),g=t.n(l),w=t("9989"),v=Object(f["a"])(p,r,a,!1,null,null,null);n["default"]=v.exports;g()(v,"components",{QPage:w["a"]})},af78:function(e,n,t){}}]);