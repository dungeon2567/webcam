(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{8041:function(e,n,t){"use strict";var r=t("af78"),a=t.n(r);a.a},"8b24":function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("q-page",{staticClass:"flex flex-center q-pa-md"},[t("div",{staticClass:"container"},[t("div",{staticClass:"video-container"},[t("video",{ref:"self",attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})]),e._l(e.participants,(function(e){return t("div",{key:e.id,staticClass:"video-container"},[t("video",{ref:"peer-"+e.id,refInFor:!0,attrs:{width:"640",height:"360",controls:"",playsinline:"",autoplay:""}})])}))],2)])},a=[],i=t("967e"),s=t.n(i),o=(t("7514"),t("20d6"),t("96cf"),t("fa84")),c=t.n(o),u={iceServers:[{url:"stun:stun01.sipphone.com"},{url:"stun:stun.ekiga.net"},{url:"stun:stun.fwdnet.net"},{url:"stun:stun.ideasip.com"},{url:"stun:stun.iptel.org"},{url:"stun:stun.rixtelecom.se"},{url:"stun:stun.schlund.de"},{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"},{url:"stun:stunserver.org"},{url:"stun:stun.softjoys.com"},{url:"stun:stun.voiparound.com"},{url:"stun:stun.voipbuster.com"},{url:"stun:stun.voipstunt.com"},{url:"stun:stun.voxgratia.org"},{url:"stun:stun.xten.com"},{url:"turn:numb.viagenie.ca",credential:"dungeon2567",username:"diego.braga.guedes@outlook.com"}]},d={name:"PageIndex",data:function(){return{participants:[]}},mounted:function(){var e=this;this.ws=new WebSocket("wss://".concat(location.host,"/room"));var n=this;this.ws.addEventListener("open",function(){var t=c()(s.a.mark((function t(r){var a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.ws.addEventListener("message",function(){var t=c()(s.a.mark((function t(r){var a,i,o,c,u,d,l,p,f;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=JSON.parse(r.data),t.t0=a.t,t.next="watcher.remove"===t.t0?4:"watcher.add"===t.t0?7:"candidate"===t.t0?12:"answer"===t.t0?16:"offer"===t.t0?20:30;break;case 4:return i=e.participants.findIndex((function(e){return e.id==a.id})),-1!=i&&(o=e.participants[i],o.peerConnection.close(),e.participants.splice(i,1)),t.abrupt("break",30);case 7:return console.log("watcher.add: "+a.id),c=e.getOrCreateParticipant(a.id),u=n.$refs.self.srcObject,u.getTracks().forEach((function(e){return c.peerConnection.addTrack(e,u)})),t.abrupt("break",30);case 12:return console.log("candidate"),d=e.participants.find((function(e){return e.id==a.id})),d&&d.peerConnection.addIceCandidate(new RTCIceCandidate(a.message)).catch((function(e){console.error(e)})),t.abrupt("break",30);case 16:return console.log("answer"),l=e.participants.find((function(e){return e.id==a.id})),l&&l.peerConnection.setRemoteDescription(a.message),t.abrupt("break",30);case 20:return p=e.getOrCreateParticipant(a.id),console.log("offer"),p.peerConnection.setRemoteDescription(a.message),t.next=25,p.peerConnection.createAnswer();case 25:return f=t.sent,t.next=28,p.peerConnection.setLocalDescription(f);case 28:return n.ws.send(JSON.stringify({t:"answer",id:a.id,message:f})),t.abrupt("break",30);case 30:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=3,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}):navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0});case 3:a=t.sent,e.$refs.self.srcObject=a,e.ws.send(JSON.stringify({t:"broadcast.start"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},methods:{getOrCreateParticipant:function(e){var n=this.participants.find((function(n){return n.id===e}));if(n)return n;n={id:e,peerConnection:new RTCPeerConnection(u),initialized:!1};var t=this;return n.peerConnection.onicecandidate=function(n){n.candidate&&t.ws.send(JSON.stringify({t:"candidate",id:e,message:n.candidate}))},n.peerConnection.onnegotiationneeded=c()(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.peerConnection.createOffer();case 2:if(a=r.sent,"stable"==n.peerConnection.signalingState){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,n.peerConnection.setLocalDescription(a);case 7:t.ws.send(JSON.stringify({t:"offer",id:e,message:a}));case 8:case"end":return r.stop()}}),r)}))),n.peerConnection.ontrack=function(e){t.$nextTick((function(){var r=t.$refs["peer-".concat(n.id)][0];r&&(r.srcObject=e.streams[0])}))},this.participants.push(n),n}}},l=d,p=(t("8041"),t("2877")),f=t("eebe"),g=t.n(f),v=t("9989"),m=Object(p["a"])(l,r,a,!1,null,null,null);n["default"]=m.exports;g()(m,"components",{QPage:v["a"]})},af78:function(e,n,t){}}]);